<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>后台管理系统</title>
<link rel="stylesheet" href="/js/layui/css/layui.css">
<script src="/js/layui/layui.js"></script>
</head>
<body>
	<form class="layui-form" id="form1">
		<div class="layui-form-item">
			<label class="layui-form-label">姓名</label>
			<div class="layui-input-inline">
				<input type="text" name="userName" placeholder="请输入"
					autocomplete="off" class="layui-input">
			</div>
			<label class="layui-form-label">ID</label>
			<div class="layui-input-inline">
				<input type="text" name="userId" placeholder="请输入"
					autocomplete="off" class="layui-input">
			</div>
		</div>


		<div class="layui-form-item">
			<div class="layui-input-block">
				<button type="submit" class="layui-btn" lay-submit lay-filter="submitButton">立即提交</button>
				<button type="reset" class="layui-btn layui-btn-primary">重置</button>
			</div>
		</div>
	</form>
	<table id="tableEle" class="layui-table" lay-filter="tableEle">	
	</table>
	<div id="tablePage"></div>

	<script type="text/html" id="tableButton">
		<a class="layui-btn layui-btn-xs" lay-event="check">查看</a>
		<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
		<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
	</script>

	<script>
		//Demo
		layui.use([ 'form', 'jquery', 'table','laypage' ],function() {
				var $ = layui.jquery, 
				form = layui.form, 
				layer = layui.layer, 
				table = layui.table,
				laypage = layui.laypage;

				var pageSize=10,pageNum=1;
				
				//监听提交
				form.on('submit(submitButton)', function(data1) {
					data1 = data1.field;
					doPage(pageSize,pageNum,data1.userId,data1.userName);
					return false;
				});
				
				table.on('tool(tableEle)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
					  console.log('1');  
					
					  var data1 = obj.data; //获得当前行数据
					  var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
					  var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
					  
					  console.log(layEvent);
					  if(layEvent === 'check'){ //查看
						  $.ajax({
								url : "/user/detail/check/page",
								contentType : 'application/json',
								data : JSON.stringify({
										"userId" : data1.userId
								}),
								type : "POST",
								dataType : "html",
								success : function(data2) {
										  layer.open({
											  type: 1,
											  fixed: true,
											  content: '<iframe>'+data2+'</iframe>', //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
											  btn: ['关闭'],
											  btn1: function(index,layero){
												  layer.close(index);
											  }
										  }); 
								}
						  });
					  }
					});
				
				function doPage(pageSize,pageNum,userId,userName){
					$.ajax({
						url : "/user/list/query",
						contentType : 'application/json',
						data : JSON.stringify({
							"pageSize" : pageSize,
							"pageNum" : pageNum,
							"condition" : {
								"userId" : userId,
								"userName" : userName
							}
						}),
						type : "POST",
						dataType : "json",
						success : function(data2) {
							if (data2.code == 0) {
								//第一个实例
								table.render({
									elem : '#tableEle',
									height : 312,
									//page: true,
									//标题栏
									cols : [
											[{field: 'userId', title: 'ID'}
									    	,{field: 'userName', title: '用户名'}
									    	,{fixed: 'right', width:200, align:'center', toolbar: '#tableButton'}
									  		]
										],
									data : data2.list
								});
								//执行一个laypage实例
								laypage.render({
									elem: 'tablePage', //注意，这里的 test1 是 ID，不用加 # 号
									count: data2.total, //数据总数，从服务端得到
									curr: data2.pageNum,
									jump: function(obj, first){
									    //obj包含了当前分页的所有参数，比如：
									    //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
									    //console.log(obj.limit); //得到每页显示的条数
									    
									    //首次不执行
									    if(!first){
									    	doPage(obj.limit,obj.curr,userId,userName);
									    }
									  }
								});
									
							} else {
								layer.alert(data2.msg, function() {
									layer.closeAll();//关闭所有弹框
								});
							}
						}
					});
				}
				
			});
		

	</script>
</body>
</html>